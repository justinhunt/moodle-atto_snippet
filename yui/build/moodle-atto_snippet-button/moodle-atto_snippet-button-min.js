YUI.add("moodle-atto_snippet-button",function(e,t){var n="atto_snippet",r="atto_snippet",i={INPUTSUBMIT:"atto_media_urlentrysubmit",INPUTCANCEL:"atto_media_urlentrycancel",KEYBUTTON:"atto_snippet_snippetbutton",HEADERTEXT:"atto_snippet_headertext",INSTRUCTIONSTEXT:"atto_snippet_instructionstext",TEMPLATEVARIABLE:"atto_snippet_snippetvariable"},s='<div id="{{elementid}}_{{innerform}}" class="mdl-align"><h4 class="'+i.HEADERTEXT+'">{{headertext}} {{snippetname}}</h4>'+'<div class="'+i.INSTRUCTIONSTEXT+'">{{instructions}}</div>'+"</div>",o='<div id="{{elementid}}_{{innerform}}" class="mdl-align"><h4 class="'+i.HEADERTEXT+'">{{headertext}}</h4>'+"</div>",u='<div id="{{elementid}}_{{innerform}}" class="atto_snippet_buttons mdl-align"><button class="'+i.KEYBUTTON+'_{{snippetindex}}">{{snippetname}}</button>'+"</div>",a='<div id="{{elementid}}_{{innerform}}" class="mdl-align">{{snippetvar}}&nbsp;<input type="text" class="'+i.TEMPLATEVARIABLE+'_{{variableindex}}" value="{{defaultvalue}}"></input>'+"</div>",f='<div id="{{elementid}}_{{innerform}}" class="mdl-align">{{variable}}</div>',l='<select class="'+i.TEMPLATEVARIABLE+'_{{variableindex}} atto_snippet_field"></select>',c='<option value="{{option}}">{{option}}</option>',h='<form class="atto_form"><div id="{{elementid}}_{{innerform}}" class="mdl-align"><button class="'+i.INPUTSUBMIT+'">{{inserttext}}</button>'+"</div>"+"</form>";e.namespace("M.atto_snippet").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,initializer:function(){if(this.get("disabled"))return;var e="iconone";this.addButton({icon:"ed/"+e,iconComponent:"atto_snippet",buttonName:e,callback:this._displayDialogue,callbackArgs:e})},_displayDialogue:function(t,r){t.preventDefault();var i=400,s=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:i+"px",focusAfterHide:r});s.width!==i+"px"&&s.set("width",i+"px");var u=e.Node.create("<div></div>"),a=e.Handlebars.compile(o),f=e.Node.create(a({headertext:M.util.get_string("chooseinsert",n)}));u.append(f);var l=this._getButtonsForSnippets(r);e.Array.each(l,function(e){u.append(e)},u),s.set("bodyContent",u),s.show(),this.markUpdated()},_showSnippetForm:function(t,r){t.preventDefault();var i=400,o=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:i+"px"});o.width!==i+"px"&&o.set("width",i+"px");var u=this._getSnippetFields(r),a=this.get("instructions")[r];a=decodeURIComponent(a);if(u&&u.length>0)var f=M.util.get_string("fieldsheader",n);else var f=M.util.get_string("nofieldsheader",n);var l=e.Handlebars.compile(s),c=e.Node.create(l({snippetname:this.get("snippetnames")[r],headertext:f,instructions:a})),h=c,p=e.Node.create("<div></div>");p.append(h),e.Array.each(u,function(e){p.append(e)},p);var d=this._getSubmitButtons(r);p.append(d),o.set("bodyContent",p),o.show(),this.markUpdated()},_getSubmitButtons:function(t){var r=e.Handlebars.compile(h),s=e.Node.create(r({elementid:this.get("host").get("elementid"),inserttext:M.util.get_string("insert",n)}));return s.one("."+i.INPUTSUBMIT).on("click",this._doInsert,this,t),s},_getSnippetFields:function(t){var n=[],r=this.get("snippetvars")[t],i=this.get("defaults")[t],s=i;return e.Array.each(r,function(t,r){if(t in s&&s[t].indexOf("|")>-1){var i=e.Handlebars.compile(f),o=e.Node.create(i({elementid:this.get("host").get("elementid"),variable:t,defaultvalue:s[t],variableindex:r})),u=e.Handlebars.compile(l),h=e.Node.create(u({variable:t,defaultvalue:s[t],variableindex:r})),p=s[t].split("|"),d="",v=e.Handlebars.compile(c);e.Array.each(p,function(t,n){var r=e.Node.create(v({option:t}));h.appendChild(r)}),o.appendChild(h)}else var m=e.Handlebars.compile(a),o=e.Node.create(m({elementid:this.get("host").get("elementid"),snippetvar:t,defaultvalue:s[t],variableindex:r}));n.push(o)},this),n},_getButtonsForSnippets:function(t){var n=[];return e.Array.each(this.get("snippetnames"),function(t,r){var s=e.Handlebars.compile(u),o=e.Node.create(s({elementid:this.get("host").get("elementid"),snippetname:t,snippetindex:r}));this._form=o,o.one("."+i.KEYBUTTON+"_"+r).on("click",this._showSnippetForm,this,r),n.push(o)},this),n},_doInsert:function(t,n){t.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var r="",s=this.get("snippets")[n],o=this.get("snippetnames")[n],u=this.get("snippetvars")[n];e.Array.each(u,function(t,n){var r=e.one("."+i.TEMPLATEVARIABLE+"_"+n),o=r.get("value");s=s.replace(new RegExp("{{"+t+"}}","g"),o)},this),r=s,this.editor.focus(),this.get("host").insertContentAtFocusPoint(r),this.markUpdated()}},{ATTRS:{disabled:{value:!1},snippets:{value:null},snippetnames:{value:null},snippetvars:{value:null},defaults:{value:null},instructions:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
